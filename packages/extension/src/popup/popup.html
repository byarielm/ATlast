<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ATlast Importer</title>
        <link rel="stylesheet" href="popup.css" />
    </head>
    <body
        class="w-[300px] min-h-[400px] font-sans bg-gradient-to-br from-cyan-50 via-purple-50 to-pink-50 dark:from-indigo-950 dark:via-purple-900 dark:to-slate-900 text-slate-900 dark:text-slate-100 transition-colors duration-300 text-center"
    >
        <div class="flex flex-col min-h-[400px]">
            <header
                class="bg-white dark:bg-slate-900 border-b-2 border-cyan-500/50 dark:border-purple-500/50 p-5 text-center"
            >
                <h1
                    class="text-xl font-bold text-purple-950 dark:text-cyan-50 space-x-3"
                >
                    ATlast Importer
                </h1>
                <p class="text-sm text-purple-750 dark:text-cyan-250">
                    Find your people in the ATmosphere
                </p>
            </header>

            <main
                id="app"
                class="flex-1 px-5 py-6 flex flex-col justify-center"
            >
                <!-- Idle state -->
                <div
                    id="state-idle"
                    class="w-full text-center flex flex-col justify-center"
                >
                    <div class="text-5xl mb-4">üîç</div>
                    <p class="text-base mb-3 text-purple-950 dark:text-cyan-50">
                        Go to your Twitter/X Following page
                    </p>
                    <a
                        href="https://x.com/following"
                        target="_blank"
                        class="w-full px-6 py-2 bg-orange-600 hover:bg-orange-500 text-white font-bold rounded-lg shadow-md hover:shadow-lg transition-all mt-4 inline-block no-underline"
                    >
                        Open X Following
                    </a>
                </div>

                <!-- Ready state -->
                <div
                    id="state-ready"
                    class="w-full text-center flex flex-col justify-center"
                >
                    <div class="text-5xl mb-4">‚úÖ</div>
                    <p class="text-base mb-3 text-purple-950 dark:text-cyan-50">
                        Ready to scan <span id="platform-name"></span>
                    </p>
                    <button
                        id="btn-start"
                        class="w-full px-6 py-2 bg-orange-600 hover:bg-orange-500 text-white font-bold rounded-lg shadow-md hover:shadow-lg transition-all mt-4"
                    >
                        Start Scan
                    </button>
                </div>

                <!-- Scraping state -->
                <div
                    id="state-scraping"
                    class="w-full text-center flex flex-col justify-center"
                >
                    <div class="text-5xl mb-4 spinner">‚è≥</div>
                    <p class="text-base mb-3 text-purple-950 dark:text-cyan-50">
                        Scanning...
                    </p>
                    <div class="mt-5">
                        <div
                            class="w-full h-2 bg-sky-50 dark:bg-slate-800 rounded overflow-hidden mb-3"
                        >
                            <div
                                id="progress-fill"
                                class="h-full bg-gradient-to-r from-orange-600 to-pink-600 w-0 transition-all duration-300 progress-fill"
                            ></div>
                        </div>
                        <p
                            class="text-base font-semibold text-purple-900 dark:text-cyan-100"
                        >
                            Found <span id="count">0</span> users
                        </p>
                    </div>
                </div>

                <!-- Complete state -->
                <div
                    id="state-complete"
                    class="w-full text-center flex flex-col justify-center"
                >
                    <div class="text-5xl mb-4">üéâ</div>
                    <p class="text-base mb-3 text-purple-950 dark:text-cyan-50">
                        Scan complete!
                    </p>
                    <p class="text-base text-purple-950 dark:text-cyan-50 mt-2">
                        Found
                        <strong
                            id="final-count"
                            class="text-orange-600 dark:text-orange-400 text-lg"
                            >0</strong
                        >
                        users
                    </p>
                    <button
                        id="btn-upload"
                        class="w-full px-6 py-2 bg-orange-600 hover:bg-orange-500 text-white font-bold rounded-lg shadow-md hover:shadow-lg transition-all mt-4"
                    >
                        Open in ATlast
                    </button>
                </div>

                <!-- Uploading state -->
                <div
                    id="state-uploading"
                    class="w-full text-center flex flex-col justify-center"
                >
                    <div class="text-5xl mb-4 spinner">üì§</div>
                    <p class="text-base mb-3 text-purple-950 dark:text-cyan-50">
                        Uploading to ATlast...
                    </p>
                </div>

                <!-- Error state -->
                <div
                    id="state-error"
                    class="w-full text-center flex flex-col justify-center"
                >
                    <div class="text-5xl mb-4">‚ö†Ô∏è</div>
                    <p
                        id="error-user-message"
                        class="text-base mb-3 text-purple-950 dark:text-cyan-50 font-semibold"
                    ></p>
                    <div
                        id="error-tips"
                        class="text-left text-[13px] text-purple-900 dark:text-cyan-100 mt-2 p-3 bg-white/50 dark:bg-slate-900/50 rounded border-l-[3px] border-orange-600"
                    >
                        <p class="font-semibold mb-2">Try these steps:</p>
                        <ul id="error-tips-list" class="list-disc pl-4 space-y-1">
                        </ul>
                    </div>
                    <details class="mt-3 text-left">
                        <summary
                            class="text-xs text-slate-500 dark:text-slate-400 cursor-pointer hover:text-slate-700 dark:hover:text-slate-300"
                        >
                            Technical details
                        </summary>
                        <p
                            id="error-technical"
                            class="text-xs text-slate-600 dark:text-slate-400 mt-2 p-2 bg-slate-100 dark:bg-slate-950/50 rounded font-mono"
                        ></p>
                    </details>
                    <button
                        id="btn-retry"
                        class="w-full px-6 py-2 bg-orange-600 hover:bg-orange-500 text-white rounded-lg font-bold shadow-md hover:shadow-lg transition-all mt-4"
                    >
                        Try Again
                    </button>
                </div>

                <!-- Server offline state -->
                <div
                    id="state-offline"
                    class="w-full flex flex-col justify-center text-center"
                >
                    <div class="text-5xl mb-4">üîå</div>
                    <p class="text-base mb-3 text-purple-950 dark:text-cyan-50">
                        Server not available
                    </p>
                    <p
                        id="dev-instructions"
                        class="text-sm text-purple-900 dark:text-cyan-100 mt-2 p-3 bg-white/50 dark:bg-slate-900/50 rounded border-l-2 border-orange-600"
                    >
                        Start the dev server:<br />
                        <code
                            class="bg-black/10 dark:bg-white/10 px-2 py-1 rounded font-mono text-sm inline-block my-2"
                            >npx netlify-cli dev --filter @atlast/web</code
                        >
                    </p>
                    <button
                        id="btn-check-server"
                        class="w-full px-6 py-2 bg-orange-600 hover:bg-orange-500 text-white rounded-lg font-medium shadow-md hover:shadow-lg transition-all mt-4"
                    >
                        Check Again
                    </button>
                </div>

                <!-- Not logged in state -->
                <div
                    id="state-not-logged-in"
                    class="w-full text-center flex flex-col justify-center"
                >
                    <div class="text-5xl mb-4">üîê</div>
                    <p class="text-base mb-3 text-purple-950 dark:text-cyan-50">
                        Not logged in to ATlast
                    </p>
                    <p
                        class="text-[13px] text-red-600 dark:text-red-400 mt-2 p-3 bg-white-50 dark:bg-slate-950/50 rounded border-l-2 border-red-600"
                    >
                        Please log in to ATlast first, then return here to scan.
                    </p>
                    <button
                        id="btn-open-atlast"
                        class="w-full px-6 py-2 bg-orange-600 hover:bg-orange-500 text-white rounded-lg font-bold shadow-md hover:shadow-lg transition-all mt-4"
                    >
                        Open ATlast
                    </button>
                    <button
                        id="btn-retry-login"
                        class="w-full px-4 py-2 text-purple-750 dark:text-cyan-250 hover:text-purple-950 dark:hover:text-cyan-50 transition-colors mt-2"
                    >
                        Check Again
                    </button>
                </div>
            </main>

            <footer class="text-left">
                <div
                    class="mt-4 px-10 py-2 -indent-6 border-orange-650/50 dark:border-amber-400/50 bg-white/50 dark:bg-slate-900/50"
                >
                    <p class="text-sm text-purple-900 dark:text-cyan-100">
                        üí° <strong>Need help?</strong> Contact @byarielm.fyi on
                        <a
                            href="https://bsky.app/profile/atlast.byarielm.fyi"
                            target="_blank"
                            class="text-orange-600 dark:text-amber-400 hover:underline"
                            >Bluesky</a
                        >
                        or
                        <a
                            href="https://tangled.org/byarielm.fyi/atlast"
                            target="_blank"
                            class="text-orange-600 dark:text-amber-400 hover:underline"
                            >Tangled</a
                        >
                    </p>
                </div>
            </footer>
        </div>

        <script type="module" src="popup.ts"></script>
    </body>
</html>
